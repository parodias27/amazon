(function(m){var n=window.AmazonUIPageJS||window.P,r=n._namespace||n.attributeErrors,f=r?r("TwisterCoreAsset",""):n;f.guardFatal?f.guardFatal(m)(f,window):f.execute(function(){m(f,window)})})(function(m,n,r){m.when("twister-variation-matrix","twister-dim-util","twister-state-machine","twister-metadata","twister-view-controller","twister-dispatcher","twister-actions","twister-slots-dimsum","twister-dimsum").register("TwisterCore",function(f,k,g,d,a,b,c,e,l){function h(c,h){this.tvm=new f(c);this.util=
new k(this.tvm);this.tsm=new g(this.tvm,this.util,c.initDimCombination);this.dimSum=new l(c.config.ajaxTimeout,c.config.ajaxUrlParams,c.config.deviceType,h);this.slotsDimSum=new e(c.config.ajaxTimeout,c.config.ajaxUrlParams,c.config.deviceType);var p=this;b.registerStore("twister-state-machine",function(b,c){p.tsm.accept(b,c).THEN(function(c){a.publishView(b,c)}).ELSE()});var t=new d;b.registerStore("twister-metadata",function(b,c){t.process(b,c,function(c){a.publishView(b,c)})})}function p(a,e){var d=
a.viewAttribution+"_"+a.viewName+"_"+e;return function(a){try{var l=c.create(e,a);b.dispatch(e,l)}catch(h){n.ueLogError&&n.ueLogError(h,{logLevel:"ERROR",attribution:"Twister_view_"+d,message:"This error is caused by the Twister view - "+d+" while updating the TwisterCore"})}}}h.prototype={registerActive:function(b,c){a.register(b.viewAttribution+"_"+b.viewName,!0,c.updateView);return{dimensionChanged:p(b,"VARIATION_CHANGE"),dimensionPeek:p(b,"VARIATION_PEEK"),metaData:p(b,"METADATA")}},registerPassive:function(b,
c){a.register(b.viewAttribution+"_"+b.viewName,!1,c.updateView);return{metaData:p(b,"METADATA")}},state:function(){return this.tsm.currentState().selected().selectionInfo()}};return h});"use strict";m.when("A").register("twister-actions",function(f){var k=f.$,g={VARIATION_CHANGE:function(d){return d=k.isArray(d)?d:[d]},VARIATION_PEEK:function(d){return d},VARIATION_SEQUENCE_ALTER:function(d){return d},INIT_SEQUENCE_ALTER_DATA:function(d){return d},METADATA:function(d){return d}};return{create:function(d,
a){return g[d]?g[d](a):!1}}});"use strict";m.when("A","publisherSubscriber").register("twister-dispatcher",function(f,k){function g(){g=1;return this}var d=f.$,a=new k,g=0,b=[];return{registerStore:function(b,e){a.register(b,e);return this},deregisterStore:function(b){a.deRegister(b);return this},dispatch:function(c,e){g?b.push(arguments):a.publish(c,e);return this},hold:g,release:function(){d.each(b,function(b,e){a.publish.apply(a,e)});g=0;return this}}});"use strict";m.when("A","publisherSubscriber").register("twister-view-controller",
function(f,k){function g(){d?a.push(arguments):(d=1,b.publish.apply(b,arguments),c.publish.apply(c,arguments),d=0,a.length&&g.apply(this,a.shift()));return this}var d=0,a=[],b=new k,c=new k;return{register:function(a,d,h){d?b.register(a,h):c.register(a,h);return this},deRegister:function(a,d){d?b.deRegister(a):c.deRegister(a);return this},publishView:g}});"use strict";m.when("A").register("twister-dimsel-api",function(f){function k(d){var a=this;this.dimSelectionMap={};this.selInfo=d;g.each(d,function(b,
c){a.dimSelectionMap[c.dimKey]=c.val})}var g=f.$;k.prototype={matches:function(d){d=d.selectionInfo();for(var a=0;a<d.length;a++){var b=d[a].dimKey;if(!(b in this.dimSelectionMap)||this.dimSelectionMap[b]!==d[a].val)return!1}return!0},selectionInfo:function(){return f.copy(this.selInfo)}};return k});"use strict";m.when("A","twister-dimsel-api").register("twister-dim-util",function(f,k){function g(a){this.tvm=a;this.dimensionMetaData={};var b=[];a=a.dimensionInfo;for(var c=0;c<a.length;c++){b.push(a[c].dimKey);
var e={};e.isRequired=a[c].isRequired;e.isSingleton=a[c].isSingleton;e.dimOrder=c;e.size=a[c].size;this.dimensionMetaData[a[c].dimKey]=e}}var d=f.$;g.prototype={createSelectionInfo:function(a){return new k(a)},extendSelectionInfo:function(a,b,c){var e=c||0===c,l={},h=[];d.each(b.selectionInfo(),function(b,a){l[a.dimKey]=a.val});d.each(a.selectionInfo(),function(b,a){b=a.dimKey;a=e?c:a.val;b in l&&(a=l[b]);h.push({dimKey:b,val:a})});return new k(h)},createNextDimSelection:function(a,b){var c=[],e=
b.selectionInfo(),l=this;d.each(a.split(":"),function(b,a){var d=e[b].dimKey;a=parseInt(a,10);l.dimensionMetaData[d].isRequired&&a!==e[b].val&&(a=-1);c.push({dimKey:d,val:a})});return new k(c)},getDimScore:function(a,b){var c=0,e=a.split(":"),l=this;d.each(b.selectionInfo(),function(b,a){var d=a.dimKey;a=a.val;var g=parseInt(e[b],10);b=e.length-b;a===g?(c+=200*b,l.dimensionMetaData[d].isRequired&&(c+=2E4)):c+=100-Math.round(Math.abs(a-g)/l.dimensionMetaData[d].size*100)});return c},isSingletonDim:function(a){return this.dimensionMetaData[a]?
this.dimensionMetaData[a].isSingleton:!1},isRequiredDim:function(a){return this.dimensionMetaData[a]?this.dimensionMetaData[a].isRequired:!1},getDimensionInfo:function(){return this.tvm.dimensionInfo},getDimAvailability:function(a,b){b=b.selectionInfo?b:this.createSelectionInfo(b);var c=[],e=[],l=this.tvm.dimensionList,h=this.tvm.dimtoValueMap[a],g=this.createSelectionInfo([{dimKey:a,val:-1}]);b=this.tvm.fetch(this.extendSelectionInfo(b,g).selectionInfo());var f={},k=this;d.each(b,function(b,c){f[c.split(":")[l.indexOf(a)]]=
k.tvm.dimCombinations[c]});d.each(h,function(b,a){b in f?c.push({index:b,asin:f[b],label:a}):e.push({index:b,label:a})});return{available:c,unavailable:e}},getUnselectedDims:function(a){var b={};d.each(a,function(a,c){b[c.dimKey]=c.val});a=[];var c=this.tvm.dimensionList,e;for(e in c)if(c.hasOwnProperty(e)){var l=c[e];if(void 0===b[l]||-1===b[l])this.isSingletonDim(l)?b[l]=0:a.push(l)}return a},showDimSum:function(a,b){b=this.getUnselectedDims(b);return!b||0===b.length||1===b.length&&b[0]===a?1:0},
isFullySelected:function(a){var b=!0;"string"===typeof a&&(a=this.getSelectionInfoFromDimComb(a));a=a.selectionInfo?a.selectionInfo():a;if(a.length!=this.tvm.dimensionList.length)return!1;d.each(a,function(a,e){-1===e.val&&(b=!1)});return b},createDimensionSelectionMap:function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var e=a[c];b[e.dimKey]=e.val}return b},getSelectedDimKeys:function(a){var b=this.tvm.dimensionList,c=[],e;for(e in b)if(b.hasOwnProperty(e)){var d=a[b[e]];"undefined"===typeof d||
-1==d?c.push("*"):c.push(d)}return c},getValidDimCombination:function(a,b){var c,e=this,l=0,h=0;a=this.tvm.fetch(a);d.each(a,function(a,d){h=e.getDimScore(d,b);h>l&&(c=a,l=h)});return a[c]},getAsinFromSelectionInfo:function(a,b){var c;"undefined"==typeof b||b?a=this.createDimensionSelectionMap(a):(c=f.copy(a),a=this.getValidDimCombination(c,this.createSelectionInfo(a)),d.each(a.split(":"),function(b,a){a=parseInt(a,10);c[b].val=a}),a=this.createDimensionSelectionMap(c));a=this.getSelectedDimKeys(a).join(":");
return this.tvm.dimCombinations[a]},getSelectionInfoFromSelectedVariationValuesMap:function(a){var b=[],c;for(c in this.tvm.dimensionList){var e={},d=this.tvm.dimensionList[c];e.dimKey=d;e.val=a[d];b.push(e)}return b},getSelectionInfoFromDimComb:function(a){var b=[];a=a.split("_");for(var c in this.tvm.dimensionList){var e={},d=a[c];e.dimKey=this.tvm.dimensionList[c];e.val="X"===d||"*"===d?-1:parseInt(d,10);b.push(e)}return b},getDimensionDisplayText:function(a){return this.tvm.dimensionDisplayText[a]},
getDimensionValueFromIndex:function(a,b){return(this.tvm.dimtoValueMap[a]||[])[b]},getSelectionInfoFromDimIndexAndValue:function(a,b){var c=[],e={};e.dimKey=this.tvm.dimensionList[a];e.val="X"===b||"*"===b?-1:parseInt(b,10);c.push(e);return c},predictNextState:function(a,b){var c=this.extendSelectionInfo(a,b);if(function(b){var a;d.each(b.selectionInfo(),function(b,c){a=-1===c.val});return a}(b)||this.tvm.exists(c.selectionInfo()))return c;a=this.extendSelectionInfo(a,b,-1);a=this.tvm.fetch(a.selectionInfo());
for(var e=b=0,l,h=0;h<a.length;h++)e=this.getDimScore(a[h],c),e>b&&(l=h,b=e);return this.createNextDimSelection(a[l],c)},getAsinToCorrespondingDimensionIndexMap:function(a){var b={};d.each(this.tvm.dimCombinations,function(c,e){b[e]=parseInt(c.split(":")[a-1])});return b},getDefaultAsinList:function(){var a=[];d.each(this.tvm.dimCombinations,function(b,c){a.push(c)});return a}};return g});"use strict";m.when("A","url-builder").register("twister-dimsum",function(f,k){function g(a,b,c,e){this.cache;
e&&(this.cache=new e);this.ajaxTimeout=a;this.batchLimit=10;this.ajaxUrl="/gp/twister/dimension?asinList\x3d###asinString###\x26vs\x3d1"+(b||"");c&&(this.ajaxUrl+="\x26deviceType\x3d"+c);(a=f.state("pwState"))&&a.isTryState&&(this.ajaxUrl=k.addUrlParams(this.ajaxUrl,{isTryState:"true"}))}var d=f.$;g.prototype={get:function(a,b,c){function e(b){var a=b-this.batchLimit;0<a&&e.call(this,a);if(b=k.slice(0>a?0:a,b).join(","))b=this.ajaxUrl.replace("###asinString###",b),f.ajax(b,{chunk:l,timeout:this.ajaxTimeout})}
function l(a){if(a)for(var e in a)if(a.hasOwnProperty(e)){var d=a[e];if(d&&d.asin){if(g){var l=h(d.asin,c);g.put(l,d)}b&&b(d)}}}function h(a,b){var c=a;f.objectIsEmpty(b)||(c={asin:a},d.extend(!0,c,b));return c}var g=this.cache,k=[],q={};d.each(a,function(a,d){a=h(d,c);g&&g.get(a)?b?b(g.get(a)):q[d]=g.get(a):k.push(d)});if(!b)return q;e.call(this,k.length)}};return g});"use strict";m.when("A").register("twister-slots-dimsum",function(f){function k(a,c,e){this.cache=d;this.ajaxTimeout=a;this.batchLimit=
8;this.ajaxUrl="/gp/twister/dimension?isDimensionSlotsAjax\x3d1\x26asinList\x3d###asinString###\x26vs\x3d1"+(c||"");e&&(this.ajaxUrl+="\x26deviceType\x3d"+e);this.defaultQuerryParamsObj={};this.defaultAddedQueryParamString=""}var g=f.$,d={},a={};k.prototype={get:function(b,c){function d(a){var b=a-this.batchLimit;0<b&&d.call(this,b);a=m.slice(0>b?0:b,a);if(b=a.join(","))b=this.ajaxUrl.replace("###asinString###",b),b+="\x26"+this.defaultAddedQueryParamString,f.ajax(b,{chunk:h,timeout:this.ajaxTimeout,
cache:!0,error:l.apply(null,a)})}function l(){var b=arguments;return function(){f.each(b,function(b){delete a[b]})}}function h(b){if(b&&b.ASIN){var d=b.ASIN;k[d]=b;for(c&&c(b);a[d]&&a[d].length;)a[d].pop()(b);delete a[d]}}var k=this.cache,m=[],q={};g.each(b,function(b,d){k[d]?c?c(k[d]):q[d]=k[d]:a[d]&&c?a[d].push(c):c&&(m.push(d),a[d]=[])});if(!c)return q;m.length&&d.call(this,m.length)},addDefaultQueryParameter:function(b,a){var d=!1;void 0!==a&&(this.defaultQuerryParamsObj[b]=a,this.defaultAddedQueryParamString=
g.param(this.defaultQuerryParamsObj),d=!0);return d},getBatchSize:function(){return 8}};return k});"use strict";m.register("twister-metadata",function(){function f(){this.config={}}f.prototype={process:function(f,g,d){"METADATA"===f&&d(g)}};return f});"use strict";m.when("A").register("publisherSubscriber",function(f){function k(){this.Subscribers=[];this.Names=[]}var g=f.$;k.prototype={register:function(d,a){if(-1<f.indexOfArray(this.Names,d))return!1;this.Names.push(d);this.Subscribers.push({name:d,
handler:a})},deRegister:function(d){var a=f.indexOfArray(this.Names,d),b=this,c=function(a,c){if(a.name===d)return b.Subscribers.splice(c,1),!0};return-1<a?(this.Names.splice(a,1),[].some?this.Subscribers.some(c):g.each(this.Subscribers,function(a,b){c(b,a)}),!0):!1},publish:function(){var d=arguments;g.each(this.Subscribers,function(a,b){setTimeout(function(){b.handler.apply(null,d)},0)})}};return k});"use strict";m.when("jQuery").register("twister-state-machine",function(f){return function(f,g,
d){function a(a,b){this.selected=function(){return a};this.peek=function(){return b}}function b(a,b){return{THEN:function(c){a&&c&&c(b());return this},ELSE:function(c){a||c&&c(b());return this}}}var c,e;this.accept=function(d,h){switch(d){case "VARIATION_PEEK":var f=g.createSelectionInfo(h);d=c();d.peek().matches(f)?h=!1:(-1===h.val?h=new a(c.selected(),c.selected()):(h=g.predictNextState(d.peek(),f),h=new a(d.selected(),h)),e=h,h=!0);h=b(h,this.currentState);break;case "VARIATION_CHANGE":d=c();h=
g.createSelectionInfo(h);f=g.getDimensionInfo();d.selected().matches(h)?h=!1:(h=h.selectionInfo().length!==f.length?g.predictNextState(d.selected(),h):h,e=new a(h,h),h=!0);h=b(h,this.currentState);break;default:h=b(!1)}return h};c=this.currentState=function(){return e};e=new a(g.createSelectionInfo(d),g.createSelectionInfo(d))}});"use strict";m.register("twister-core-store-utils",function(f){return{branch:function(f,g){return{THEN:function(d){if(f&&d){var a=g?g():f;d(a)}return this},ELSE:function(d){if(!f&&
d){var a=g?g():f;d(a)}return this}}}}});"use strict";m.when("A","twister-core-store-utils","dp-sort-filter-api").register("variation-sequence-alter",function(f,k,g){return function(d){function a(a){a=n.alterSequence(a);h=c(a,m);return!0}function b(a){var b=d.getDefaultAsinList();l=a?a.slotRowNumber:void 0;m=d.getAsinToCorrespondingDimensionIndexMap(l);n=new e.SortFilterMain(a.alterData,b,m);return!0}function c(a,b){var c={};f.each(a,function(a,d){c[b[a]]=d});return c}var e=this,l,h={},m={};this.StoreUtils=
k;this.SortFilterMain=g;var n;this.accept=function(c,d){switch(c){case "VARIATION_SEQUENCE_ALTER":c=this.StoreUtils.branch(a(d),this.getAlteredIndicesMap);break;case "INIT_SEQUENCE_ALTER_DATA":c=this.StoreUtils.branch(b(d));break;default:c=this.StoreUtils.branch(!1)}return c};this.getAlteredIndicesMap=function(){return h}}});"use strict";m.when("A").register("twister-variation-matrix",function(f){function k(b){b=f.copy(b);var c=this;this.dimCombinations=b.dimCombinations;this.validCombinatonString=
" "+f.keys(b.dimCombinations).join("  ")+" ";this.dimensionInfo=b.dimensionInfo;this.dimensionList=b.dimensionList;this.dimensionDisplayText=b.dimensionDisplayText;this.config=b.config;this.dimInfoMap={};a.each(this.dimensionInfo,function(a,b){var d=b.dimKey,f={};f.size=b.size;f.dimOrder=a;c.dimInfoMap[d]=f});this.dimtoValueMap=b.dimtoValueMap}function g(b){b=a.map(b,function(a){a=a.val;return-1===a?"\\d+":""+a}).join(":");return new RegExp("\\s"+b+"\\s","gm")}function d(b){return a.map(b,function(a){return""+
a.val}).join(":")}var a=f.$;k.prototype={fetch:function(b){b=g(b);b=this.validCombinatonString.match(b);return b=a.map(b,function(b){return a.trim(b)})},exists:function(a){return d(a)in this.dimCombinations}};return k});"use strict";m.when("A","jQuery").register("url-builder",function(f,k){function g(a,c){var d;if(a&&c&&"object"==typeof c){d=a;var g="?";f.each(c,function(a,b){a=c[b];d+=g+b+"\x3d"+a;g="\x26"})}return d}function d(a){var c;a&&(c=a.split("?")[0]);return c}function a(a){var c={};a&&(a=
a.split("?"),1<a.length&&(a=a[1].split("\x26"),f.each(a,function(a,b){a=a.split("\x3d");c[a[0]]=a[1]})));return c}return{addUrlParams:function(b,c){var e=b;b&&c&&"object"==typeof c&&(e=d(b),b=a(b),b=k.extend(b,c),e=g(e,b));return e},removeUrlParams:function(b,c){var e=b;if(b&&c&&"object"==typeof c){var e=d(b),k=a(b);f.each(c,function(a,b){delete k[a]});e=g(e,k)}return e}}})});